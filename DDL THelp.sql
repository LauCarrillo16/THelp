CREATE DATABASE THelp;
USE THelp;

CREATE TABLE USUARIO_ROL(
ID_USUARIO_ROL BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
DESCRIPCION VARCHAR(50)
);

CREATE TABLE USUARIO_ESTADO(
ID_USUARIO_ESTADO BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
DESCRIPCION VARCHAR(50)
);

CREATE TABLE USUARIO (
ID_USUARIO BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
NICK VARCHAR(50),
CORREO VARCHAR(100),
CONTRASEÑA VARCHAR(255),
ID_ESTADO INT,
ID_ROL INT,
FOREIGN KEY(ID_ESTADO) REFERENCES USUARIO_ESTADO(ID_USUARIO_ESTADO),
FOREIGN KEY(ID_ROL) REFERENCES USUARIO_ROL(ID_USUARIO_ROL)
);

CREATE TABLE ESTADO_TICKET(
ID_ESTADO_TICKET BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
DESCRIPCION VARCHAR(50)
);

CREATE TABLE TICKET(
ID_TICKET BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
ASUNTO VARCHAR(100),
DESCRIPCION TEXT,
USUARIO_CREACION INT,
FECHA_CREACION TIMESTAMP,
RESPUESTA TEXT,
USUARIO_RESPUESTA INT,
FECHA_RESPUESTA TIMESTAMP,
ID_ESTADO_TICKET INT,
FOREIGN KEY (USUARIO_CREACION) REFERENCES USUARIO(ID_USUARIO),
FOREIGN KEY (USUARIO_RESPUESTA) REFERENCES USUARIO(ID_USUARIO),
FOREIGN KEY (ID_ESTADO_TICKET) REFERENCES ESTADO_TICKET(ID_ESTADO_TICKET)
);

CREATE TABLE LOGS (
ID_LOG BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
ACCION VARCHAR (255),
ID_USUARIO_LOG INT,
ID_TICKET_LOG INT,
DESCRIPCION TEXT,
FECHA_LOG TIMESTAMP,
FOREIGN KEY (ID_USUARIO_LOG) REFERENCES USUARIO(ID_USUARIO),
FOREIGN KEY (ID_TICKET_LOG) REFERENCES TICKET(ID_TICKET)
)

INSERT INTO USUARIO_ROL(DESCRIPCION) VALUES('Usuario');
INSERT INTO USUARIO_ROL(DESCRIPCION) VALUES('Soporte');
INSERT INTO USUARIO_ROL(DESCRIPCION) VALUES('Administrador');
INSERT INTO USUARIO_ESTADO(DESCRIPCION) VALUES('Activo');
INSERT INTO USUARIO_ESTADO(DESCRIPCION) VALUES('Inactivo');
INSERT INTO USUARIO(NICK, CORREO, CONTRASEÑA, ID_ESTADO, ID_ROL) VALUES ('admin','admin@gmail.com', 'admin12345', 1, 3);
INSERT INTO ESTADO_TICKET(DESCRIPCION) VALUES ('Abierto');
INSERT INTO ESTADO_TICKET(DESCRIPCION) VALUES ('En Proceso');
INSERT INTO ESTADO_TICKET(DESCRIPCION) VALUES ('Cerrado');
INSERT INTO ESTADO_TICKET(DESCRIPCION) VALUES ('Cancelado');